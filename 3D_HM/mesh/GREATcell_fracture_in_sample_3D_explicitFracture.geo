lc = 0.0075/2;
lc1 = 0.01/2;
lc2= 0.01/2; // 0.001;
r0 = 0.097;//Outer egde of sample
r1 = 0.090;//Measuring location in sample
r2 = 0.065;//Inner ring in smaple
r3= 0.06; //fracture
segouter = 37;
segmid = 37;
seginner = 13;

//Note angle rotates anticlockwise, so use - to go clockwise
fracture_angle_to_bag1_sx = 0;

th = fracture_angle_to_bag1_sx*Pi/180;
sth = Sin(th);
cth = Cos(th);

p70x = r2;
p70y = 0;
p71x = 0;
p71y = r2;
p72x = -r2;
p72y = 0;
p73x = 0;
p73y = -r2;

Point(1)={0.0989400395497483,-0.0145213144685405,0,lc};
Point(2)={0.0989400395497483,0,0,lc};
Point(3)={0.0989400395497483,0.0145213144685405,0,lc};
Point(4)={0.0979528917494459,0.0194840415895657,0,lc};
Point(5)={0.0969657439491436,0.0244467687105909,0,lc};
Point(6)={0.0914086774858697,0.0378627139332354,0,lc};
Point(7)={0.0858516110225958,0.05127865915588,0,lc};
Point(8)={0.0830404519257676,0.0554858560599625,0,lc};
Point(9)={0.0802292928289395,0.0596930529640449,0,lc};
Point(10)={0.0699611728964922,0.0699611728964922,0,lc};
Point(11)={0.0596930529640449,0.0802292928289395,0,lc};
Point(12)={0.0554858560599625,0.0830404519257676,0,lc};
Point(13)={0.05127865915588,0.0858516110225958,0,lc};
Point(14)={0.0378627139332354,0.0914086774858697,0,lc};
Point(15)={0.0244467687105908,0.0969657439491436,0,lc};
Point(16)={0.0194840415895657,0.0979528917494459,0,lc};
Point(17)={0.0145213144685405,0.0989400395497483,0,lc};
Point(18)={6.93889390390723E-18,0.0989400395497483,0,lc};
Point(19)={-0.0145213144685405,0.0989400395497483,0,lc};
Point(20)={-0.0194840415895657,0.0979528917494459,0,lc};
Point(21)={-0.0244467687105908,0.0969657439491436,0,lc};
Point(22)={-0.0378627139332354,0.0914086774858697,0,lc};
Point(23)={-0.05127865915588,0.0858516110225958,0,lc};
Point(24)={-0.0554858560599625,0.0830404519257676,0,lc};
Point(25)={-0.0596930529640449,0.0802292928289395,0,lc};
Point(26)={-0.0699611728964922,0.0699611728964922,0,lc};
Point(27)={-0.0802292928289395,0.0596930529640449,0,lc};
Point(28)={-0.0830404519257677,0.0554858560599624,0,lc};
Point(29)={-0.0858516110225958,0.05127865915588,0,lc};
Point(30)={-0.0914086774858697,0.0378627139332354,0,lc};
Point(31)={-0.0969657439491436,0.0244467687105908,0,lc};
Point(32)={-0.0979528917494459,0.0194840415895657,0,lc};
Point(33)={-0.0989400395497483,0.0145213144685405,0,lc};
Point(34)={-0.0989400395497483,-9.54097911787244E-18,0,lc};
Point(35)={-0.0989400395497483,-0.0145213144685405,0,lc};
Point(36)={-0.0979528917494459,-0.0194840415895657,0,lc};
Point(37)={-0.0969657439491436,-0.0244467687105909,0,lc};
Point(38)={-0.0914086774858697,-0.0378627139332354,0,lc};
Point(39)={-0.0858516110225958,-0.05127865915588,0,lc};
Point(40)={-0.0830404519257676,-0.0554858560599625,0,lc};
Point(41)={-0.0802292928289395,-0.0596930529640449,0,lc};
Point(42)={-0.0699611728964922,-0.0699611728964922,0,lc};
Point(43)={-0.059693052964045,-0.0802292928289395,0,lc};
Point(44)={-0.0554858560599625,-0.0830404519257676,0,lc};
Point(45)={-0.05127865915588,-0.0858516110225958,0,lc};
Point(46)={-0.0378627139332354,-0.0914086774858697,0,lc};
Point(47)={-0.0244467687105908,-0.0969657439491436,0,lc};
Point(48)={-0.0194840415895657,-0.0979528917494459,0,lc};
Point(49)={-0.0145213144685405,-0.0989400395497483,0,lc};
Point(50)={2.60208521396521E-17,-0.0989400395497483,0,lc};
Point(51)={0.0145213144685405,-0.0989400395497483,0,lc};
Point(52)={0.0194840415895657,-0.0979528917494459,0,lc};
Point(53)={0.0244467687105909,-0.0969657439491436,0,lc};
Point(54)={0.0378627139332354,-0.0914086774858697,0,lc};
Point(55)={0.05127865915588,-0.0858516110225958,0,lc};
Point(56)={0.0554858560599625,-0.0830404519257676,0,lc};
Point(57)={0.0596930529640449,-0.0802292928289395,0,lc};
Point(58)={0.0699611728964922,-0.0699611728964922,0,lc};
Point(59)={0.0802292928289396,-0.0596930529640449,0,lc};
Point(60)={0.0830404519257677,-0.0554858560599624,0,lc};
Point(61)={0.0858516110225958,-0.0512786591558799,0,lc};
Point(62)={0.0914086774858697,-0.0378627139332354,0,lc};
Point(63)={0.0969657439491436,-0.0244467687105908,0,lc};
Point(64)={0.0979528917494459,-0.0194840415895657,0,lc};

Point(65) = { 0, 0, 0, lc1};
Point(655) = { 0, 0., 0.2-1e-6, lc1};
Point(66) = {r0, 0, 0, lc};
Point(67) = {0, r0, 0, lc};
Point(68) = {-r0, 0, 0, lc};
Point(69) = {0, -r0, 0, lc};



Point(70) = {r2, 0, 0, lc2};
Point(70000) = {r3, 0, 0, lc1};
Point(71) = {0., r2, 0, lc2};
Point(72) = {-r2, 0., 0, lc2};
Point(73) = {0, -r2, 0, lc2};

Point(74) = {r1, 0, 0, lc1};
Point(75) = {0, r1, 0, lc1};
Point(76) = {-r1, 0, 0, lc1};
Point(77) = {0, -r1, 0, lc1};

Circle(1) = {66, 65, 67};
Circle(2) = {66, 65, 69};
Circle(3) = {67, 65, 68};
Circle(4) = {68, 65, 69};

Line(5)={1,2};
Line(6)={2,3};
Line(7)={3,4};
Line(8)={4,5};
Line(9)={5,6};
Line(10)={6,7};
Line(11)={7,8};
Line(12)={8,9};
Line(13)={9,10};
Line(14)={10,11};
Line(15)={11,12};
Line(16)={12,13};
Line(17)={13,14};
Line(18)={14,15};
Line(19)={15,16};
Line(20)={16,17};
Line(21)={17,18};
Line(22)={18,19};
Line(23)={19,20};
Line(24)={20,21};
Line(25)={21,22};
Line(26)={22,23};
Line(27)={23,24};
Line(28)={24,25};
Line(29)={25,26};
Line(30)={26,27};
Line(31)={27,28};
Line(32)={28,29};
Line(33)={29,30};
Line(34)={30,31};
Line(35)={31,32};
Line(36)={32,33};
Line(37)={33,34};
Line(38)={34,35};
Line(39)={35,36};
Line(40)={36,37};
Line(41)={37,38};
Line(42)={38,39};
Line(43)={39,40};
Line(44)={40,41};
Line(45)={41,42};
Line(46)={42,43};
Line(47)={43,44};
Line(48)={44,45};
Line(49)={45,46};
Line(50)={46,47};
Line(51)={47,48};
Line(52)={48,49};
Line(53)={49,50};
Line(54)={50,51};
Line(55)={51,52};
Line(56)={52,53};
Line(57)={53,54};
Line(58)={54,55};
Line(59)={55,56};
Line(60)={56,57};
Line(61)={57,58};
Line(62)={58,59};
Line(63)={59,60};
Line(64)={60,61};
Line(65)={61,62};
Line(66)={62,63};
Line(67)={63,64};
Line(68)={64,1};

Circle(69) = {70, 65, 71};
Circle(70) = {70, 65, 73};
Circle(71) = {71, 65, 72};
Circle(72) = {72, 65, 73};

Circle(73) = {74, 65, 75};
Circle(74) = {74, 65, 77};
Circle(75) = {75, 65, 76};
Circle(76) = {76, 65, 77};


//Line(77) = {70,72};

/*
Transfinite Line(1) = segouter Using Progression 1.0;//Outer
Transfinite Line(2) = segouter Using Progression 1.0;
Transfinite Line(3) = segouter Using Progression 1.0;
Transfinite Line(4) = segouter Using Progression 1.0;

Transfinite Line(69) = seginner Using Progression 1.0;//Inner
Transfinite Line(70) = seginner Using Progression 1.0;
Transfinite Line(71) = seginner Using Progression 1.0;
Transfinite Line(72) = seginner Using Progression 1.0;

Transfinite Line(73) = segmid Using Progression 1.0;//Mid
Transfinite Line(74) = segmid Using Progression 1.0;
Transfinite Line(75) = segmid Using Progression 1.0;
Transfinite Line(76) = segmid Using Progression 1.0;*/

Line Loop(1) = {69, 71, -77};
Line Loop(2) = {72, -70, 77};
Line Loop(3) = {1, 3, 4, -2};
Line Loop(4) = {5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68};
Line Loop(5) = {73, 75, 76, -74};


//Line(77) = {65, 70000};


//+
Curve Loop(8) = {71, 72, -70, 69};
Curve Loop(6) = {78, 79, 80, 77};



Plane Surface(8) = {8};
Plane Surface(3) = {5,8};
Plane Surface(4) = {3,5};
Plane Surface(5) = {4,3};


For i In {5:68}
  Extrude {0, 0, 0.2} {
      Line{i}; 
    }
EndFor

For i In {1:4}
    Extrude {0, 0, 0.2} {
      Curve{i}; 
    }
EndFor
For i In {69:76}
    Extrude {0, 0, 0.2} {
      Curve{i}; 
    }
EndFor


//+
Curve Loop(9) = {133, 137, 141, 145, 149, 153, 157, 161, 165, 169, 173, 177, 181, 185, 189, 193, 197, 201, 205, 209, 213, 217, 221, 225, 229, 233, 237, 241, 245, 249, 253, 257, 261, 265, 269, 273, 277, 281, 285, 289, 293, 297, 301, 305, 309, 313, 317, 321, 325, 329, 77, 81, 85, 89, 93, 97, 101, 105, 109, 113, 117, 121, 125, 129};
//+
Curve Loop(10) = {333, 341, 345, -337};
//+
Plane Surface(381) = {9, 10};
//+
Curve Loop(11) = {377, -369, 365, 373};
//+
Plane Surface(382) = {10, 11};
//+
Curve Loop(12) = {357, 361, -353, 349};
//+
Plane Surface(383) = {12};
//+
Plane Surface(384) = {11, 12};


Surface Loop(1) = {8, 352, 356, 360, 364, 383};

Volume(1) = {1};


Surface Loop(3) = {4, 368, 372, 380, 376,  336, 340, 344, 348, 382};
//+
Volume(3) = {3};


Surface Loop(2) = {3, 368, 372, 380, 376,  352, 356, 360, 364, 384};
//+
Volume(2) = {2};



Surface Loop(4) = {5, 80, 84, 88, 92, 96, 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140, 144, 148, 152, 156, 160, 164, 168, 172, 176, 180, 184, 188, 192, 196, 200, 204, 208, 212, 216, 220, 224, 228, 232, 236, 240, 244, 248, 252, 256, 260, 264, 268, 272, 276, 280, 284, 288, 292, 296, 300, 304, 308, 312, 316, 320, 324, 328, 332, 336, 340, 344, 348, 381};

//+
Volume(4) = {4};


lc_f = 0.005;
Point(500) = {0.0, 0.0, 0.06, lc_f};
Point(501) = {0.04, 0.0, 0.06, lc_f};
Point(502) = {0.04, 0.0, 0.16, lc_f};
Point(503) = {0.0, 0.0, 0.16, lc_f};
Point(504) = {0.0, 0.0, 0.16+1e-7, lc_f};
Point(505) = {0.02, 0.0, 0.18, lc_f};
//+
Line(504) = {503, 502};
//+
Line(505) = {502, 501};
//+
Line(506) = {501, 500};
//+
Line(507) = {500, 503};
//+
Curve Loop(501) = {504, 505, 506, 507};
//+
Plane Surface(500) = {501};


Line(508) = {503, 655};
Line(509) = {503, 505};
Line(510) = {505, 655};

Curve Loop(502) = {509, 510, -508};
Plane Surface(501) = {502};

Surface{500} In Volume{1};
Surface{501} In Volume{1};
//Curve{508} In Volume{1};

Physical Volume(1) = {1, 2, 3, 4};
//Physical Surface(2) = {500};
//Physical Surface(3) = {501};


